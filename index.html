<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cumperi</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- Navbar -->
<nav>
  <div class="logo">Mini eMag</div>
  <div class="nav-links">
    <a href="#">Acasă</a>
    <a href="#">Produse</a>
    <a href="#">Contact</a>
    <div class="cart">
      Coș: <span id="cart-count">0</span>
      <button id="view-cart-btn">Vezi coș</button>
    </div>
    <div class="nav-user">
      <span id="user-email"></span>
      <button id="logout-btn" style="display:none;">Logout</button>
    </div>
  </div>
</nav>

<!-- Banner -->
<div class="banner">
  <h1>Bine ai venit la MiniMag!</h1>
  <p>Cele mai bune produse la un click distanță</p>
</div>

<!-- Autentificare -->
<div class="auth-form">
  <input type="email" id="auth-email" placeholder="Email">
  <input type="password" id="auth-password" placeholder="Parolă">
  <button id="register-btn">Înregistrează-te</button>
  <button id="login-btn">Loghează-te</button>
  <p id="auth-msg"></p>
</div>

<!-- Adăugare produse (doar logați) -->
<div class="add-product-form" style="display:none;">
  <button id="add-product-btn">Adaugă produs nou</button>
</div>

<!-- Căutare + filtre -->
<div class="filter-container">
  <input type="text" id="search" placeholder="Caută produse...">
  <select id="category-filter">
    <option value="All">Toate categoriile</option>
    <option value="Telefoane">Telefoane</option>
    <option value="Laptopuri">Laptopuri</option>
    <option value="Accesorii">Accesorii</option>
    <option value="Tablete">Tablete</option>
    <option value="Televizoare">Televizoare</option>
  </select>
  <select id="sort-filter">
    <option value="none">Sortare</option>
    <option value="asc">Preț crescător</option>
    <option value="desc">Preț descrescător</option>
  </select>
</div>

<!-- Produse -->
<div class="container">
  <div class="products" id="products">
    <!-- Produsele vor fi încărcate din Firestore -->
  </div>
</div>

<!-- Coș -->
<div id="cart-container" class="cart-container" style="display:none;">
  <h2>Coșul tău</h2>
  <ul id="cart-items"></ul>
  <p>Total: <span id="cart-total">0</span> RON</p>
  <button id="close-cart">Închide</button>
</div>

<footer>
  &copy; 2025 Mini eMag | Toate drepturile rezervate
</footer>

<script>
  // Config Firebase
  const firebaseConfig = {
    apiKey: "API_KEY_TAU",
    authDomain: "PROIECT.firebaseapp.com",
    projectId: "PROIECT",
    storageBucket: "PROIECT.appspot.com",
    messagingSenderId: "ID",
    appId: "APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const userEmailSpan = document.getElementById('user-email');
  const logoutBtn = document.getElementById('logout-btn');

  const loginBtn = document.getElementById('login-btn');
  const registerBtn = document.getElementById('register-btn');
  const authEmail = document.getElementById('auth-email');
  const authPassword = document.getElementById('auth-password');
  const authMsg = document.getElementById('auth-msg');

  const addProductBtn = document.getElementById('add-product-btn');
  const productsDiv = document.getElementById('products');

  // Login & Register
  registerBtn.addEventListener('click', () => {
    const email = authEmail.value.trim();
    const password = authPassword.value.trim();
    if(email && password){
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => authMsg.textContent = "Înregistrare reușită!")
        .catch(error => authMsg.textContent = error.message);
    } else authMsg.textContent = "Completează toate câmpurile!";
  });

  loginBtn.addEventListener('click', () => {
    const email = authEmail.value.trim();
    const password = authPassword.value.trim();
    if(email && password){
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => authMsg.textContent = "Login reușit!")
        .catch(error => authMsg.textContent = error.message);
    } else authMsg.textContent = "Completează toate câmpurile!";
  });

  logoutBtn.addEventListener('click', () => {
    auth.signOut().then(() => alert('Te-ai deconectat!'));
  });

  auth.onAuthStateChanged(user => {
    if(user){
      document.querySelector('.auth-form').style.display = 'none';
      document.querySelector('.add-product-form').style.display = 'block';
      userEmailSpan.textContent = user.email;
      logoutBtn.style.display = 'inline-block';
    } else {
      document.querySelector('.auth-form').style.display = 'block';
      document.querySelector('.add-product-form').style.display = 'none';
      userEmailSpan.textContent = '';
      logoutBtn.style.display = 'none';
    }
  });

  // Adăugare produs
  addProductBtn.addEventListener('click', () => {
    const title = prompt("Titlu produs:");
    const description = prompt("Descriere produs:");
    const price = parseFloat(prompt("Preț produs:"));
    const image = prompt("URL imagine:");
    if(title && description && price && image){
      db.collection('products').add({title, description, price, image})
        .then(() => alert('Produs adăugat!'))
        .catch(err => alert(err));
    } else alert('Completează toate câmpurile!');
  });

  // Încarcă produse în timp real
  db.collection('products').onSnapshot(snapshot => {
    productsDiv.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const card = `
        <div class="product-card" data-category="${data.category || 'All'}" data-price="${data.price}">
          <img src="${data.image}" alt="${data.title}">
          <h3>${data.title}</h3>
          <p class="product-desc">${data.description || ''}</p>
          <p class="price">${data.price} RON</p>
          <button onclick="addToCart('${data.title}', ${data.price})">Adaugă în coș</button>
        </div>
      `;
      productsDiv.innerHTML += card;
    });
  });

  // Coș de cumpărături
  let cart = [];
  function addToCart(name, price){
    cart.push({name, price});
    document.getElementById('cart-count').textContent = cart.length;
    renderCart();
  }

  function renderCart(){
    const cartItems = document.getElementById('cart-items');
    cartItems.innerHTML = '';
    let total = 0;
    cart.forEach(item => {
      total += item.price;
      cartItems.innerHTML += `<li>${item.name} - ${item.price} RON</li>`;
    });
    document.getElementById('cart-total').textContent = total;
  }

  document.getElementById('view-cart-btn').addEventListener('click', () => {
    document.getElementById('cart-container').style.display = 'block';
  });
  document.getElementById('close-cart').addEventListener('click', () => {
    document.getElementById('cart-container').style.display = 'none';
  });

</script>
</body>
</html>
