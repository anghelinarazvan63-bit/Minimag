<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini eMag</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>
<body>

    <!-- Autentificare -->
    <div id="auth-container">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Parolă">
        <button onclick="register()">Înregistrează-te</button>
        <button onclick="login()">Login</button>
        <p id="auth-msg"></p>
    </div>

    <!-- Adaugă anunț -->
    <div class="add-product-container">
        <input type="file" id="productImage">
        <button id="addBtn" onclick="uploadAndAddProduct()" style="display:none;">➕ Adaugă anunț</button>
    </div>

    <!-- Navbar -->
    <nav>
        <div class="logo">Mini eMag</div>
        <div class="nav-links">
            <a href="#">Acasă</a>
            <a href="#">Produse</a>
            <a href="#">Contact</a>
            <div class="cart">
                Coș: <span id="cart-count">0</span>
                <button id="view-cart-btn">Vezi coș</button>
            </div>
        </div>
    </nav>

    <!-- Banner -->
    <div class="banner">
        <h1>Bine ai venit la MiniMag!</h1>
        <p>Cele mai bune produse la un click distanță</p>
    </div>

    <!-- Filtre + Căutare -->
    <div class="filter-container">
        <input type="text" id="search" placeholder="Caută produse...">
        <select id="category-filter">
            <option value="All">Toate categoriile</option>
            <option value="Telefoane">Telefoane</option>
            <option value="Laptopuri">Laptopuri</option>
            <option value="Accesorii">Accesorii</option>
            <option value="Tablete">Tablete</option>
            <option value="Televizoare">Televizoare</option>
        </select>
        <select id="sort-filter">
            <option value="none">Sortare</option>
            <option value="asc">Preț crescător</option>
            <option value="desc">Preț descrescător</option>
        </select>
    </div>

    <!-- Produse -->
    <div class="container">
        <div class="products" id="products"></div>
    </div>

    <!-- Coș -->
    <div id="cart-container" class="cart-container" style="display:none;">
        <h2>Coșul tău</h2>
        <ul id="cart-items"></ul>
        <p>Total: <span id="cart-total">0</span> RON</p>
        <button id="close-cart">Închide</button>
    </div>

    <footer>
        &copy; 2025 Mini eMag | Toate drepturile rezervate
    </footer>

    <!-- SCRIPT -->
    <script>
    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyB8IUYlmq4kceZhC3gp6e8Mk9G7eLzrYvM",
        authDomain: "minimag-7ad90.firebaseapp.com",
        projectId: "minimag-7ad90",
        storageBucket: "minimag-7ad90.firebasestorage.app",
        messagingSenderId: "685055029064",
        appId: "1:685055029064:web:8e2fe8f8b689245dd24d7d",
        measurementId: "G-SCMXR51H2G"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Mesaj autentificare
    function msg(text){ document.getElementById("auth-msg").innerText = text; }

    // REGISTER
    function register() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        auth.createUserWithEmailAndPassword(email, password)
            .then(() => msg("Cont creat ✔"))
            .catch(e => msg(e.message));
    }

    // LOGIN
    function login() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        auth.signInWithEmailAndPassword(email, password)
            .then(() => msg("Logat ✔"))
            .catch(e => msg(e.message));
    }

    // USER LOGAT
    auth.onAuthStateChanged(user => {
        if(user){
            document.getElementById("addBtn").style.display = "block";
            loadProducts();
        }
    });

    // UPLOAD + ADAUGĂ PRODUS
    function uploadAndAddProduct() {
        const title = prompt("Titlu produs:");
        const price = prompt("Preț:");

        const file = document.getElementById("productImage").files[0];
        if(!file) return alert("Alege o imagine!");
        const user = auth.currentUser;
        if(!user) return alert("Nu ești logat");

        const storageRef = storage.ref('products/' + file.name);
        const uploadTask = storageRef.put(file);

        uploadTask.on('state_changed', 
            snapshot => {},
            error => alert(error),
            () => {
                uploadTask.snapshot.ref.getDownloadURL().then(url => {
                    db.collection("products").add({
                        title,
                        price,
                        image: url,
                        userId: user.uid
                    }).then(() => alert("Anunț adăugat cu imagine ✔"));
                });
            }
        );
    }

    // ÎNCARCĂ TOATE PRODUSELE
    function loadProducts() {
        db.collection("products").onSnapshot(snapshot => {
            const div = document.getElementById("products");
            div.innerHTML = "";
            snapshot.forEach(doc => {
                const p = doc.data();
                div.innerHTML += `
                    <div class="product-card">
                        <img src="${p.image}">
                        <h3>${p.title}</h3>
                        <p>${p.price} RON</p>
                    </div>
                `;
            });
        });
    }
    </script>
</body>
    </html>
