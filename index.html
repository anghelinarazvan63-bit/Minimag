<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini eMag</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyB8IUYlmq4kceZhC3gp6e8Mk9G7eLzrYvM",
        authDomain: "minimag-7ad90.firebaseapp.com",
        projectId: "minimag-7ad90",
        storageBucket: "minimag-7ad90.firebasestorage.app",
        messagingSenderId: "685055029064",
        appId: "1:685055029064:web:8e2fe8f8b689245dd24d7d",
        measurementId: "G-SCMXR51H2G"
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth();
    </script>

    <!-- Navbar -->
    <nav>
        <div class="logo">Mini eMag</div>
        <div class="nav-links">
            <a href="#">Acasă</a>
            <a href="#">Produse</a>
            <a href="#">Contact</a>
            <div class="cart">
                Coș: <span id="cart-count">0</span>
                <button id="view-cart-btn">Vezi coș</button>
            </div>
        </div>
    </nav>

    <!-- Banner -->
    <div class="banner">
        <h1>Bine ai venit la MiniMag!</h1>
        <p>Cele mai bune produse la un click distanță</p>
    </div>

    <!-- Formular adaugare produs -->
    <div class="add-product-form">
        <h2>Adaugă un produs</h2>
        <input type="text" id="new-title" placeholder="Titlu produs">
        <input type="number" id="new-price" placeholder="Preț produs">
        <input type="text" id="new-description" placeholder="Descriere produs">
        <input type="text" id="new-category" placeholder="Categorie produs">
        <input type="text" id="new-image" placeholder="URL imagine">
        <button id="add-product-btn">Adaugă produs</button>
    </div>

    <!-- Filtre -->
    <div class="filter-container">
        <input type="text" id="search" placeholder="Caută produse...">
        <select id="category-filter">
            <option value="All">Toate categoriile</option>
            <option value="Telefoane">Telefoane</option>
            <option value="Laptopuri">Laptopuri</option>
            <option value="Accesorii">Accesorii</option>
            <option value="Tablete">Tablete</option>
            <option value="Televizoare">Televizoare</option>
        </select>
        <select id="sort-filter">
            <option value="none">Sortare</option>
            <option value="asc">Preț crescător</option>
            <option value="desc">Preț descrescător</option>
        </select>
    </div>

    <!-- Produse -->
    <div class="container">
        <div class="products" id="products"></div>
    </div>

    <!-- Coș -->
    <div id="cart-container" class="cart-container" style="display:none;">
        <h2>Coșul tău</h2>
        <ul id="cart-items"></ul>
        <p>Total: <span id="cart-total">0</span> RON</p>
        <button id="close-cart">Închide</button>
    </div>

    <footer>
        &copy; 2025 Mini eMag | Toate drepturile rezervate
    </footer>

    <!-- Script JS -->
    <script>
    // ---------- Elemente ----------
    const productsDiv = document.getElementById('products');
    const searchInput = document.getElementById('search');
    const categoryFilter = document.getElementById('category-filter');
    const sortFilter = document.getElementById('sort-filter');
    const addBtn = document.getElementById('add-product-btn');

    // ---------- Coș ----------
    let cart = [];
    const cartItems = document.getElementById('cart-items');
    const cartTotal = document.getElementById('cart-total');
    const cartCount = document.getElementById('cart-count');
    const cartContainer = document.getElementById('cart-container');

    document.getElementById('view-cart-btn').onclick = () => {
        cartContainer.style.display = 'block';
    };
    document.getElementById('close-cart').onclick = () => {
        cartContainer.style.display = 'none';
    };

    function addToCart(title, price) {
        const existing = cart.find(item => item.title === title);
        if(existing){
            existing.qty += 1;
        } else {
            cart.push({title, price, qty: 1});
        }
        updateCartUI();
    }

    function updateCartUI(){
        cartItems.innerHTML = '';
        let total = 0;
        cart.forEach(item => {
            const li = document.createElement('li');
            li.textContent = `${item.title} x${item.qty} - ${item.price*item.qty} RON`;
            cartItems.appendChild(li);
            total += item.price * item.qty;
        });
        cartTotal.textContent = total;
        cartCount.textContent = cart.reduce((a,b)=>a+b.qty,0);
    }

    // ---------- Încarcă produse ----------
    function loadProducts(){
        db.collection('products').onSnapshot(snapshot => {
            let products = [];
            snapshot.forEach(doc => {
                const data = doc.data();
                data.id = doc.id;
                products.push(data);
            });
            displayProducts(products);
        });
    }

    function displayProducts(products){
        // Filtrare categorie
        const category = categoryFilter.value;
        if(category !== "All") products = products.filter(p => p.category === category);

        // Căutare
        const search = searchInput.value.toLowerCase();
        if(search) products = products.filter(p => p.title.toLowerCase().includes(search));

        // Sortare
        const sort = sortFilter.value;
        if(sort === 'asc') products.sort((a,b)=>a.price-b.price);
        if(sort === 'desc') products.sort((a,b)=>b.price-a.price);

        // Afișare
        productsDiv.innerHTML = '';
        products.forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${p.image}" alt="${p.title}">
                <h3>${p.title}</h3>
                <p class="product-desc">${p.description || ''}</p>
                <p class="price">${p.price} RON</p>
                <button onclick="addToCart('${p.title}', ${p.price})">Adaugă în coș</button>
            `;
            productsDiv.appendChild(card);
        });
    }

    // ---------- Input filtre ----------
    searchInput.addEventListener('input', loadProducts);
    categoryFilter.addEventListener('change', loadProducts);
    sortFilter.addEventListener('change', loadProducts);

    // ---------- Adaugă produs ----------
    addBtn.addEventListener('click', () => {
        const title = document.getElementById('new-title').value.trim();
        const price = parseFloat(document.getElementById('new-price').value);
        const description = document.getElementById('new-description').value.trim();
        const category = document.getElementById('new-category').value.trim();
        const image = document.getElementById('new-image').value.trim();

        if(title && !isNaN(price) && description && category && image){
            db.collection('products').add({
                title, price, description, category, image
            }).then(() => {
                alert('Produs adăugat cu succes!');
                document.getElementById('new-title').value = '';
                document.getElementById('new-price').value = '';
                document.getElementById('new-description').value = '';
                document.getElementById('new-category').value = '';
                document.getElementById('new-image').value = '';
            }).catch(err => alert(err));
        } else {
            alert('Completează toate câmpurile corect!');
        }
    });

    // ---------- Init ----------
    loadProducts();
    </script>
</body>
    </html>
